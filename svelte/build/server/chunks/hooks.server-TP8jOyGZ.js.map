{"version":3,"file":"hooks.server-TP8jOyGZ.js","sources":["../../../.svelte-kit/adapter-node/chunks/hooks.server.js"],"sourcesContent":["import { o as overwriteServerAsyncLocalStorage, e as extractLocaleFromRequestAsync, s as strategy, l as localizeUrl, d as deLocalizeUrl, a as serverAsyncLocalStorage } from \"./runtime.js\";\nasync function paraglideMiddleware(request, resolve, callbacks) {\n  if (!serverAsyncLocalStorage) {\n    const { AsyncLocalStorage } = await import(\"async_hooks\");\n    overwriteServerAsyncLocalStorage(new AsyncLocalStorage());\n  } else if (!serverAsyncLocalStorage) {\n    overwriteServerAsyncLocalStorage(createMockAsyncLocalStorage());\n  }\n  const locale = await extractLocaleFromRequestAsync(request);\n  const origin = new URL(request.url).origin;\n  if (request.headers.get(\"Sec-Fetch-Dest\") === \"document\" && strategy.includes(\"url\")) {\n    const localizedUrl = localizeUrl(request.url, { locale });\n    if (normalizeURL(localizedUrl.href) !== normalizeURL(request.url)) {\n      const headers = {};\n      if (strategy.includes(\"preferredLanguage\")) {\n        headers[\"Vary\"] = \"Accept-Language\";\n      }\n      const response2 = new Response(null, {\n        status: 307,\n        headers: {\n          Location: localizedUrl.href,\n          ...headers\n        }\n      });\n      return response2;\n    }\n  }\n  const newRequest = strategy.includes(\"url\") ? new Request(deLocalizeUrl(request.url), request) : (\n    // need to create a new request object because some metaframeworks (nextjs!) throw otherwise\n    // https://github.com/opral/inlang-paraglide-js/issues/411\n    new Request(request)\n  );\n  const messageCalls = /* @__PURE__ */ new Set();\n  const response = await serverAsyncLocalStorage?.run({ locale, origin, messageCalls }, () => resolve({ locale, request: newRequest }));\n  return response;\n}\nfunction normalizeURL(url) {\n  const urlObj = new URL(url);\n  urlObj.pathname = urlObj.pathname.replace(/\\/$/, \"\");\n  return urlObj.href;\n}\nfunction createMockAsyncLocalStorage() {\n  let currentStore = void 0;\n  return {\n    getStore() {\n      return currentStore;\n    },\n    async run(store, callback) {\n      currentStore = store;\n      try {\n        return await callback();\n      } finally {\n        currentStore = void 0;\n      }\n    }\n  };\n}\nconst handleParaglide = ({ event, resolve }) => paraglideMiddleware(event.request, ({ request, locale }) => {\n  event.request = request;\n  return resolve(event, {\n    transformPageChunk: ({ html }) => html.replace(\"%paraglide.lang%\", locale)\n  });\n});\nconst handle = handleParaglide;\nexport {\n  handle\n};\n"],"names":[],"mappings":"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"}